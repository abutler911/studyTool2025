<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="manifest" href="manifest.json" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="Aircraft Limits" />

    <script>
      // Enhanced service worker registration with update detection
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("./sw.js")
            .then((registration) => {
              console.log("SW registered:", registration);

              // Check for updates
              registration.addEventListener("updatefound", () => {
                console.log("New service worker found!");
                const newWorker = registration.installing;

                newWorker.addEventListener("statechange", () => {
                  if (
                    newWorker.state === "installed" &&
                    navigator.serviceWorker.controller
                  ) {
                    // New service worker available, show update notification
                    showUpdateNotification();
                  }
                });
              });

              // Check for updates every 30 seconds
              setInterval(() => {
                registration.update();
              }, 30000);
            })
            .catch((error) => console.log("SW registration failed:", error));
        });

        // Listen for controller change (when new SW takes over)
        navigator.serviceWorker.addEventListener("controllerchange", () => {
          window.location.reload();
        });
      }

      function showUpdateNotification() {
        // Create update notification
        const updateBanner = document.createElement("div");
        updateBanner.id = "update-banner";
        updateBanner.innerHTML = `
          <div style="
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0, 255, 65, 0.1);
            border: 1px solid #00ff41;
            color: #00ff41;
            padding: 10px;
            text-align: center;
            z-index: 10000;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
          ">
            üöÄ New version available! 
            <button onclick="updateApp()" style="
              background: rgba(0, 255, 65, 0.1);
              border: 1px solid #00ff41;
              color: #00ff41;
              padding: 5px 10px;
              margin-left: 10px;
              cursor: pointer;
              font-family: 'JetBrains Mono', monospace;
            ">UPDATE NOW</button>
            <button onclick="dismissUpdate()" style="
              background: transparent;
              border: 1px solid rgba(0, 255, 65, 0.5);
              color: rgba(0, 255, 65, 0.7);
              padding: 5px 10px;
              margin-left: 5px;
              cursor: pointer;
              font-family: 'JetBrains Mono', monospace;
            ">Later</button>
          </div>
        `;
        document.body.appendChild(updateBanner);
      }

      function updateApp() {
        if (navigator.serviceWorker.controller) {
          navigator.serviceWorker.controller.postMessage({
            type: "SKIP_WAITING",
          });
        }
      }

      function dismissUpdate() {
        const banner = document.getElementById("update-banner");
        if (banner) {
          banner.remove();
        }
      }
    </script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aircraft Limitations Study Tool</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>‚úàÔ∏è Aircraft Limitations Study Tool</h1>
        <p>Master your aircraft limitations with interactive study modes</p>
      </div>
      <div class="controls">
        <select id="category-select" onchange="changeCategory()">
          <option value="Structural Limitations">Structural Limitations</option>
          <option value="Structural Dimensions">Structural Dimensions</option>
          <option value="Max Altitude and Temp Limits">
            Max Altitude and Temp Limits
          </option>
          <option value="Airspeed and Mach Limits">
            Airspeed and Mach Limits
          </option>
          <option value="Max Flap Operating Speed">
            Max Flap Operating Speed
          </option>
          <option value="Starter Cranking Limits on Ground">
            Starter Cranking Limits on Ground
          </option>
          <option value="Starter Cranking Limits in Flight">
            Starter Cranking Limits in Flight
          </option>
          <option value="Dry Motoring Cycle Limits">
            Dry Motoring Cycle Limits
          </option>
          <option value="APU Starter Duty Cycle">APU Starter Duty Cycle</option>
          <option value="APU Operational Limits to Start">
            APU Operational Limits to Start
          </option>
          <option value="APU Operational Limits for Cont Operation">
            APU Operational Limits for Cont Operation
          </option>
          <option value="Fuel">Fuel</option>
          <option value="Pressurization">Pressurization</option>
          <option value="Memory Items">Memory Items</option>
        </select>
      </div>
      <div class="controls">
        <button class="btn active" onclick="setMode('study')">
          üìö Study Mode
        </button>
        <button class="btn" onclick="setMode('quiz')">üß† Quiz Mode</button>
        <button class="btn" onclick="setMode('fill')">‚úèÔ∏è Fill-in Mode</button>
        <button class="btn" onclick="setMode('timer')">
          ‚è±Ô∏è Timer Challenge
        </button>
        <button class="btn" onclick="resetProgress()">üîÑ Reset</button>
      </div>
      <div class="stats">
        <div class="stat">
          <div class="stat-value" id="correct-count">0</div>
          <div class="stat-label">Correct</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="incorrect-count">0</div>
          <div class="stat-label">Incorrect</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="streak-count">0</div>
          <div class="stat-label">Streak</div>
        </div>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="progress-fill"></div>
      </div>
      <div class="timer" id="timer" style="display: none">Time: 05:00</div>
      <div class="table-container">
        <table id="limitations-table">
          <thead id="table-head"></thead>
          <tbody id="table-body"></tbody>
        </table>
      </div>
    </div>
    <script src="script.js"></script>
  </body>
</html>
